<main class="dashboard-wrapper">
  
  <header class="dash-header">
    <h1>Dashboard ğŸ’°</h1>
    <div class="filter-container">
      <input type="month" class="modern-input" [(ngModel)]="mesAnoSelecionado" (ngModelChange)="filtrarPorMes()">
    </div>
  </header>

  <section class="kpi-grid">
    <div class="kpi-card receita">
      <span class="kpi-label">Receitas</span>
      <h3 class="kpi-value">{{ totalReceitas | currency:'BRL' }}</h3>
    </div>
    <div class="kpi-card despesa">
      <span class="kpi-label">Despesas</span>
      <h3 class="kpi-value">{{ totalDespesas | currency:'BRL' }}</h3>
    </div>
    <div class="kpi-card saldo">
      <span class="kpi-label">Saldo</span>
      <h3 class="kpi-value">{{ saldoGeral | currency:'BRL' }}</h3>
    </div>
  </section>

  <div class="main-layout">
    <div class="card-white chart-box">
      <h3>ğŸ• Despesas por Categoria</h3>
      <div class="canvas-wrapper">
        <canvas id="canvasCategorias"></canvas>
      </div>
    </div>

    <div class="side-actions">
      <div class="card-white">
        <h3>âœ¨ Novo LanÃ§amento</h3>
        <div class="form-stack">
          <input type="text" class="modern-input" placeholder="DescriÃ§Ã£o" [(ngModel)]="novaTransacao.descricao">
          <div class="form-row">
            <input type="number" class="modern-input" placeholder="R$ 0,00" [(ngModel)]="novaTransacao.valor">
            <select class="modern-select" [(ngModel)]="novaTransacao.tipo">
              <option value="despesa">ğŸ’¸ Gasto</option>
              <option value="receita">ğŸ’° Ganho</option>
            </select>
          </div>
          <button (click)="adicionarTransacao()" class="btn-primary">Salvar</button>
        </div>
      </div>

      <div class="card-white import-box">
        <h3>ğŸ“¥ Importar CSV</h3>
        <div class="file-area">
          <label for="file-upload" class="custom-file-upload">
            {{ arquivoSelecionado ? 'ğŸ“„ ' + arquivoSelecionado.name : 'ğŸ“ Escolher Arquivo' }}
          </label>
          <input id="file-upload" type="file" (change)="onFileSelected($event)" accept=".csv">
          
          <button (click)="importarArquivo()" [disabled]="!arquivoSelecionado" class="btn-secondary">
            Processar Arquivo
          </button>
        </div>
      </div>
    </div>
  </div>

  <section class="list-container">
    <div class="list-header">
      <h3>ğŸ“‹ LanÃ§amentos</h3>
      <select class="modern-select small" [(ngModel)]="categoriaSelecionada" (ngModelChange)="mudarCategoria()">
        <option value="Todas">Todas Categorias</option>
        @for (cat of categoriasDisponiveis; track cat) { <option [value]="cat">{{ cat }}</option> }
      </select>
    </div>

    <div class="t-stack">
      @for (t of transacoesFiltradas; track t.id) {
        <div class="t-card" [class.t-receita]="t.tipo === 'receita'" [class.t-despesa]="t.tipo === 'despesa'">
          <div class="t-info">
            <span class="t-name">{{ t.descricao }}</span>
            <small>{{ t.data_transacao | date:'dd/MM' }} â€¢ {{ t.categoria }}</small>
          </div>
          <div class="t-price-box">
            <span class="t-price" [class.txt-g]="t.tipo === 'receita'">
              {{ t.valor | currency:'BRL' }}
            </span>
            <button (click)="excluirTransacao(t.id)" class="btn-icon">ğŸ—‘ï¸</button>
          </div>
        </div>
      }
    </div>
  </section>
</main>